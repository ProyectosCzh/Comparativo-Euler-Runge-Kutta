ANÁLISIS Y RECOMENDACIONES DE REFACTORIZACIÓN (API SOLVER)
==========================================================

1. ESTADO ACTUAL (DIAGNÓSTICO)
------------------------------
Actualmente, la API concentra toda la lógica en un único endpoint monolítico: `POST /solve`.
Este endpoint tiene múltiples responsabilidades (violación del Principio de Responsabilidad Única):
- Parsea ecuaciones (predefinidas y custom).
- Selecciona y ejecuta algoritmos numéricos (Euler, RK4).
- Calcula soluciones analíticas.
- Realiza comparaciones y cálculos de error (RMSE).
- Formatea una respuesta compleja que incluye todo lo anterior.

Problemas detectados:
- Complejidad Cognitiva: Es difícil para un consumidor de la API entender qué parámetros son obligatorios para cada caso (ej. `comparison_mode` a veces es irrelevante).
- Acoplamiento: Si falla la generación de la solución analítica, podría afectar la respuesta completa, incluso si solo querías el resultado de Euler.
- Flexibilidad Limitada: No se puede pedir "solo la solución analítica" sin pasar por la estructura de `SolveRequest` completa.

2. PROPUESTA DE REFACTORIZACIÓN (4 ENDPOINTS)
---------------------------------------------
Se recomienda dividir la funcionalidad en 4 endpoints especializados. Esto hace la API más "RESTful", modular y fácil de entender.

A. ENDPOINT 1: EULER
   - Ruta: `POST /solve/euler`
   - Propósito: Resolver una EDO usando exclusivamente el método de Euler.
   - Entrada: Ecuación, Condición Inicial, Dominio, Paso (h).
   - Salida: Lista de puntos (x, y) y tiempo de cómputo.
   - Ventaja: Respuesta rápida y ligera, sin sobrecarga de comparaciones.

B. ENDPOINT 2: RUNGE-KUTTA 4 (RK4)
   - Ruta: `POST /solve/rk4`
   - Propósito: Resolver una EDO usando exclusivamente el método RK4.
   - Entrada: Ecuación, Condición Inicial, Dominio, Paso (h).
   - Salida: Lista de puntos (x, y) y tiempo de cómputo.
   - Ventaja: Ideal para obtener alta precisión sin configurar modos de comparación.

C. ENDPOINT 3: SOLUCIÓN ANALÍTICA
   - Ruta: `POST /solve/analytic`
   - Propósito: Obtener la solución exacta de la ecuación (si existe).
   - Entrada: Ecuación (ID predefinido), Condición Inicial, Dominio, Paso (para muestreo de puntos).
   - Salida: Expresión matemática (string) y lista de puntos evaluados.
   - Ventaja: Permite graficar la curva "real" independientemente de los métodos numéricos.

D. ENDPOINT 4: COMPARADOR (BENCHMARK)
   - Ruta: `POST /solve/compare`
   - Propósito: Ejecutar múltiples métodos y compararlos entre sí o contra la analítica.
   - Entrada: Ecuación, Condición Inicial, Dominio, Paso, Lista de Métodos (["Euler", "RK4"]).
   - Salida: Objeto complejo con resultados de cada método, solución analítica (si aplica) y métricas de error (RMSE, Max Error).
   - Ventaja: Centraliza la lógica pesada de análisis de errores, separándola de la ejecución pura.

3. CAMBIOS TÉCNICOS NECESARIOS
------------------------------

A. Refactorización de Servicios (`solver_service.py`)
   - Extraer la lógica de preparación de la ecuación (`get_predefined_f` / `build_custom_f`) a un servicio común o dependencia inyectable.
   - Crear funciones atómicas en el servicio:
     - `solve_euler(...)`
     - `solve_rk4(...)`
     - `solve_analytic(...)`
     - `solve_benchmark(...)` (que orqueste las anteriores).

B. Actualización de Schemas (`ode_schemas.py`)
   - Crear schemas de Request/Response específicos para cada endpoint para limpiar la documentación Swagger.
     - `EulerRequest` / `EulerResponse`
     - `RK4Request` / `RK4Response`
     - `AnalyticRequest` / `AnalyticResponse`
   - Mantener `SolveRequest` (o renombrarlo a `CompareRequest`) solo para el endpoint de comparación.

C. Estructura de Rutas (`ode_solver.py`)
   - Reemplazar el único `@router.post("/solve")` por los 4 nuevos decoradores.

4. BENEFICIOS ESPERADOS
-----------------------
- Claridad: La documentación (Swagger UI) mostrará claramente qué hace cada endpoint.
- Mantenibilidad: Si hay un bug en Euler, no afecta al endpoint de RK4.
- Escalabilidad: Es más fácil agregar nuevos métodos (ej. `POST /solve/heun`) sin tocar la lógica de comparación existente.
